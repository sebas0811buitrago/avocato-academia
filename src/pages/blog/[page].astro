---
import CardBlogPrimary from "@/components/Blog/CardBlogPrimary.astro"
import CardBlogSecondary from "@/components/Blog/CardBlogSecondary.astro"
import ImageBlogCard from "@/components/Blog/ImageBlogCard.astro"
import ImageBlogCardSecondary from "@/components/Blog/ImageBlogCardSecondary.astro"
import { BreadCrumb, getBreadcrumbs } from "@/components/BreadCrumb"
import Footer from "@/components/Footer.astro"
import { Header } from "@/components/Header"
import Tags from "@/components/Tags.astro"
import TagsContainer from "@/components/TagsContainer.astro"
import Subtitle from "@/components/Typography/Subtitle.astro"
import Title from "@/components/Typography/Title.astro"
import Layout from "@/layouts/Layout.astro"
import getSortedPosts from "@/utils/getSortedPosts"
import { getCollection } from "astro:content"

export async function getStaticPaths({ paginate }) {
	const PAGE_SIZE = 2

	const allPosts = getSortedPosts(await getCollection("posts")).slice(5)

	console.log("allPosts", allPosts)

	// Generate pages from our array of astronauts, with 2 to a page
	return paginate(allPosts, { pageSize: PAGE_SIZE })
}
// All paginated data is passed on the "page" prop
const { page } = Astro.props

// console.log("page", page)

const allPosts = getSortedPosts(await getCollection("posts"))

const pageTitle = "My Astro Learning Blog"

const currentPath = Astro.url.pathname

const breadcrumbs = getBreadcrumbs(currentPath)

const tags = [...new Set(allPosts.map((post) => post.data.tags).flat())]

const lastPosts1 = allPosts.slice(0, 3)
const lastPosts2 = allPosts.slice(3, 5)
---

<Layout title={pageTitle}>
	<Header slot="header" class="bg-light-primary" />

	<main>
		<header class="flex flex-col items-center gap-3 bg-light-primary px-4 pb-10 pt-32">
			<Title> Nuestro blog </Title>

			<BreadCrumb breadcrumb={breadcrumbs} />

			<TagsContainer>
				{
					tags.map((tag) => (
						<a href={`/tag/${tag}`}>
							<Tags>{tag}</Tags>
						</a>
					))
				}
			</TagsContainer>
		</header>

		<div class="mx-auto flex w-full max-w-screen-xl flex-col items-center gap-12 px-4 pt-14">
			<Subtitle> Últimas entradas del blog </Subtitle>
			<section class="w-full">
				<ul
					class="grid w-full auto-rows-[200px] grid-rows-[repeat(4,minmax(0,250px))] gap-6 lg:grid-cols-2 lg:grid-rows-[repeat(2,minmax(0,300px))]"
				>
					{
						lastPosts1.map((post, index) => {
							const {
								data: {
									thumbnail: { alt, image },
									title,
									tags,
									pubDate,
								},
								slug,
							} = post
							const isMainCard = index === 0
							return (
								<CardBlogPrimary
									class:list={[isMainCard && "row-span-2"]}
									isMainCard={isMainCard}
									date={pubDate}
									tags={tags}
									title={title}
									href={`/blog/${slug}/`}
								>
									<ImageBlogCard slot={"image"} src={image} alt={alt} />
								</CardBlogPrimary>
							)
						})
					}
					{
						lastPosts2.map((post) => {
							const {
								data: {
									thumbnail: { alt, image },
									title,
									tags,
									pubDate,
								},
								slug,
							} = post
							return (
								<CardBlogSecondary date={pubDate} tags={tags} title={title} href={`/blog/${slug}/`}>
									<ImageBlogCardSecondary slot={"image"} src={image} alt={alt} />
								</CardBlogSecondary>
							)
						})
					}
				</ul>
			</section>

			<div class="flex w-full items-center gap-6" id="mas-articulos">
				<Subtitle>Más artículos</Subtitle>
				<hr class="flex-1 border-2 border-accent" />
			</div>
		</div>
	</main>

	<h1>Page {page.currentPage}</h1>

	<ul>
		<!--List the array of astronaut info-->

		hola
		{page.data.map(({ data: { title } }) => <li>{title}</li>)}
	</ul>

	<Footer slot="footer" />
</Layout>
