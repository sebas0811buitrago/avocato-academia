---
import CardBlogPrimary from "@/components/Blog/CardBlogPrimary.astro"
import ImageBlogCard from "@/components/Blog/ImageBlogCard.astro"
import { BreadCrumb, getBreadcrumbs } from "@/components/BreadCrumb"
import Footer from "@/components/Footer.astro"
import { Header } from "@/components/Header"
import Tags from "@/components/Tags.astro"
import TagsContainer from "@/components/TagsContainer.astro"
import Subtitle from "@/components/Typography/Subtitle.astro"
import Title from "@/components/Typography/Title.astro"
import Layout from "@/layouts/Layout.astro"
import { getCollection } from "astro:content"

const allPosts = await getCollection("posts")

const pageTitle = "My Astro Learning Blog"

const currentPath = Astro.url.pathname

const breadcrumbs = getBreadcrumbs(currentPath)

const tags = [...new Set(allPosts.map((post) => post.data.tags).flat())]
---

<Layout title={pageTitle}>
	<Header slot="header" class="bg-light-primary shadow-none" />
	<main>
		<header class="flex flex-col items-center gap-3 bg-light-primary px-4 pb-10 pt-32">
			<Title> Nuestro blog </Title>

			<BreadCrumb breadcrumb={breadcrumbs} />

			<TagsContainer>
				{
					tags.map((tag) => (
						<a href={`/tag/${tag}`}>
							<Tags>{tag}</Tags>
						</a>
					))
				}
			</TagsContainer>
		</header>

		<div class="mx-auto flex w-full max-w-screen-xl flex-col items-center gap-8 px-4 pt-14">
			<Subtitle> Ãšltimas entradas del blog </Subtitle>
			<section class="w-full">
				<ul
					class="grid w-full grid-rows-[repeat(4,minmax(0,230px))] gap-4 lg:grid-cols-2 lg:grid-rows-[repeat(2,minmax(0,230px))]"
				>
					{
						allPosts.map(
							(
								{
									data: {
										thumbnail: { alt, image },
										title,
										tags,
										pubDate,
									},
									slug,
								},
								index
							) => (
								<CardBlogPrimary
									class:list={[index === 0 && "row-span-2"]}
									overlay={index === 0 ? "gradient" : "full"}
									date={pubDate}
									tags={tags}
									title={title}
									href={`/blog/${slug}/`}
								>
									<ImageBlogCard slot={"image"} src={image} alt={alt} />
								</CardBlogPrimary>
							)
						)
					}
				</ul>
			</section>
		</div>
	</main>

	<Footer slot="footer" />
</Layout>
